# AI営業エージェントシステム 技術要件定義書（MVP版）

## 1. 技術スタック選定 (Tech Stack)

「開発スピード最優先」「初期コスト最小化（原則フリーティア活用）」をテーマに選定。

### 1.1. フロントエンド & アプリケーション

| 項目 | 選定 | 理由 |
|------|------|------|
| **Framework** | Next.js 15 (App Router) | SSR/Server Componentsを活用し、高速な初期表示を実現 |
| **Language** | TypeScript | 型安全性によるバグ抑制と保守性向上 |
| **Hosting** | Vercel | Next.jsの最適化環境。CI/CDパイプラインが自動構築されるためDevOps工数削減 |

### 1.2. UI/UX & デザインシステム

| 項目 | 選定 | 理由 |
|------|------|------|
| **Component Library** | shadcn/ui | Radix UIベースのアクセシブルなコンポーネント集。カスタマイズ容易で「管理画面」構築に最適 |
| **Data Grid** | shadcn/ui Data Table | 本システムの肝。フィルタ、ソート、ページネーション、一括操作（チェックボックス）を実装 |
| **Styling** | Tailwind CSS | ユーティリティファーストで高速開発 |
| **Icons** | Lucide React | シンプルでモダンなアイコンセット |

#### デバイスサポート

- **Desktop Only (PC/Chrome)**
- MVPモックアップ作成においては、モバイル（スマホ・タブレット）対応は一切考慮しない
- レスポンシブ実装を行わず、PCブラウザでの表示最適化にリソースを集中する

### 1.3. バックエンド & データベース

| 項目 | 選定 | 理由 |
|------|------|------|
| **BaaS** | Supabase | PostgreSQL + Auth + Storage が統合されたBaaS |
| **Database** | PostgreSQL | リレーショナルデータ管理 |
| **Auth** | Supabase Auth (Google) | 社内Google WorkspaceアカウントでのSSO的な運用が可能 |
| **Storage** | Supabase Storage | 名刺画像（OCR前）の保存 |

### 1.4. AI & 外部API連携

| 項目 | 選定 | 理由 |
|------|------|------|
| **LLM API** | Google Gemini API (`gemini-1.5-flash`) | 社内Google環境との親和性が高い。処理速度が非常に高速でコストも安価 |
| **Email Sending** | Resend | Vercel/Next.jsとの親和性が最強。React Emailでテンプレート作成可能 |
| **OCR** | Google Gemini API (Multimodal) | 画像を直接プロンプトに含めてJSON形式で名刺データを抽出。専用OCR APIより実装が簡易で安価 |

---

## 2. システムアーキテクチャ

### 2.1. データフロー概要

```
1. ユーザーがNext.js経由で「アプローチ実行」ボタンを押す
2. Server Actionがリクエストを受け付け、Supabaseに「ドラフト生成タスク」を登録
3. 非同期処理がタスクを検知
4. Gemini APIが企業情報を読み込み、指定された戦略（Mass/Account）に基づいて文面を生成
5. 生成結果をSupabaseのdraftsテーブルに保存
6. フロントエンドが更新され「承認待ち」が表示される
```

### 2.2. バッチ処理の方針

**課題**: VercelのServerless Functionにはタイムアウト（通常10秒〜60秒）があるため、100件一括生成などの処理で落ちる可能性がある。

**MVP方針**: クライアント側で `Promise.all` + 並列数制限（5件ずつ）でリクエストし、バックエンドの複雑性を排除する。

---

## 3. 開発運用スコープ（MVP限定）

### 3.1. アプローチチャネルの制限

- **メール営業のみ**を実装する
- 技術的難易度と保守コストの高い「問い合わせフォーム自動送信」機能は、MVPスコープから除外する

### 3.2. モバイル対応の除外

- システムは**デスクトップ（PC）のChromeブラウザ**での利用を前提とする
- レスポンシブ対応、モバイル向けレイアウト調整は行わない

### 3.3. マルチテナント対応

- MVPでは**シングルテナント**（1組織のみ）を前提とする
- 複数企業での利用は想定しない

### 3.4. メール受信機能

- MVPでは**メール受信の自動取り込みは実装しない**
- 受信トレイは手動登録 or 将来的なWebhook連携を想定

---

## 4. コスト試算 (月額ランニングコスト)

| サービス | プラン | 費用 | 備考 |
|----------|--------|------|------|
| Vercel | Hobby | $0 | 商用利用時はPro($20/member)推奨だが、MVP検証段階ならHobbyで可 |
| Supabase | Free | $0 | データベース500MBまで無料。MVPには十分 |
| Google Gemini | Pay-as-you-go | ~$0-5 | gemini-1.5-flashは無料枠が大きく、超過分も非常に安価 |
| Resend | Free | $0 | 月3,000通まで無料。1日100通制限あり（ドメイン認証で緩和） |
| **合計** | | **ほぼ ¥0** | Geminiの無料枠内であればサーバー代も含めほぼ無料 |

---

## 5. 開発ロードマップ

### Phase 1: 基盤構築

- Next.js + Supabase + shadcn/ui のボイラープレート作成
- DBスキーマの適用と型生成
- 認証機能（Googleログイン/サインアップ）の実装

### Phase 2: リスト管理 & UI構築

- Data Tableを用いた「Excel風」データグリッドの実装
- CSVインポート機能の実装
- プロジェクト設定画面の実装

### Phase 3: AIロジック & メール連携

- Gemini API連携（プロンプトエンジニアリング含む）
- 売上規模に応じた分岐ロジックの実装
- Resend API連携（送信機能）
- OCR機能の実装（名刺読み取りにGeminiを使用）

### Phase 4: テスト & チューニング

- プロンプトの精度調整
- UIのレスポンス改善
- バグフィックス

---

## 関連ドキュメント

- [全体要件定義書](../overview/requirements.md)
- [デザインシステム](../design/design-system.md)
- [レイアウト定義](../design/layout-definition.md)
